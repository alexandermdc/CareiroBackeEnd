generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model associacao {
  id_associacao String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome          String
  descricao     String
  vendedor      vendedor[]
}

model atende_um {
  id_pedido   Int
  id_vendedor String   @db.Uuid
  pedido      pedido   @relation(fields: [id_pedido], references: [pedido_id], onDelete: NoAction, onUpdate: NoAction)
  vendedor    vendedor @relation(fields: [id_vendedor], references: [id_vendedor], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_pedido, id_vendedor])
}

model cliente {
  cpf           String        @id @db.VarChar(11)
  nome          String
  email         String        @unique
  telefone      String        @db.VarChar(11)
  senha         String        @db.VarChar(100)
  tipo_usuario  TipoUsuario   @default(CLIENTE)
  
  favoritos     favorita_um[]
  pedido        pedido[]
  sacola        sacola_de_compras?
}

model feira {
  id_feira Int      @id @default(autoincrement())
  nome     String
  endereco String
  pedido   pedido[]
}

model pedido {
  pedido_id              Int           @id @default(autoincrement())
  data_pedido            DateTime      @default(dbgenerated("CURRENT_DATE")) @db.Date
  status                 String        @default("PENDENTE")
  mercadopago_payment_id String?       @unique
  fk_feira               Int?
  fk_cliente             String        @db.VarChar(11)
  atende_um              atende_um[]
  produtos_no_pedido     item_pedido[]
  cliente                cliente       @relation(fields: [fk_cliente], references: [cpf], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente")
  feira                  feira?        @relation(fields: [fk_feira], references: [id_feira], onDelete: NoAction, onUpdate: NoAction, map: "fk_feira")
}

model categoria {
  nome         String
  id_categoria String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  produto      produto[]
}

model produto {
  id_produto       String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome             String
  preco            Float
  fk_vendedor      String        @db.Uuid
  descricao        String
  image            String
  is_promocao      Boolean
  preco_promocao   Float?
  id_categoria     String        @db.Uuid
  disponivel       Boolean
  favoritado_por   favorita_um[]
  itens_em_pedidos item_pedido[]
  vendedor         vendedor      @relation(fields: [fk_vendedor], references: [id_vendedor], onDelete: NoAction, onUpdate: NoAction, map: "fk_vendedor")
  categoria        categoria     @relation(fields: [id_categoria], references: [id_categoria])
  em_sacolas sacola_produtos[] 
}

model vendedor {
  nome             String
  email            String         @unique
  telefone         String         @db.VarChar(15)
  endereco_venda   String
  tipo_vendedor    tipo_vendedor
  tipo_documento   tipo_documento
  numero_documento String
  id_vendedor      String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fk_associacao    String?        @db.Uuid
  senha            String         @db.VarChar(100)
  tipo_usuario     TipoUsuario    @default(VENDEDOR)
  
  atende_um        atende_um[]
  produto          produto[]
  associacao       associacao?    @relation(fields: [fk_associacao], references: [id_associacao], onDelete: NoAction, onUpdate: NoAction, map: "fk_associacao")
}

model item_pedido {
  id_item_pedido String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quantidade     Int
  pedido_id      Int
  produto_id     String  @db.Uuid
  pedido         pedido  @relation(fields: [pedido_id], references: [pedido_id])
  produto        produto @relation(fields: [produto_id], references: [id_produto])
}

model favorita_um {
  id_favorito String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cliente_cpf String  @db.VarChar(11)
  produto_id  String  @db.Uuid
  cliente     cliente @relation(fields: [cliente_cpf], references: [cpf])
  produto     produto @relation(fields: [produto_id], references: [id_produto])

  @@unique([cliente_cpf, produto_id])
}

model sacola_de_compras {
  id_sacola   String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fk_cliente  String      @db.VarChar(11) @unique
  cliente     cliente     @relation(fields: [fk_cliente], references: [cpf], map: "fk_cliente", onDelete: NoAction, onUpdate: NoAction)
  produtos  sacola_produtos[]
}

model sacola_produtos {
  id_sacola_pedido String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quantidade       Int     @default(1) 
  id_sacola        String  @db.Uuid
  produto_id       String  @db.Uuid
  sacola           sacola_de_compras @relation(fields: [id_sacola], references: [id_sacola])
  produto          produto @relation(fields: [produto_id], references: [id_produto])

  @@unique([id_sacola, produto_id])
}

enum tipo_documento {
  CPF
  CNPJ
}

enum tipo_vendedor {
  PF
  PJ
}

enum TipoUsuario {
  CLIENTE
  VENDEDOR
  ADMIN
}
